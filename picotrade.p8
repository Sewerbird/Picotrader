pico-8 cartridge // http://www.pico-8.com
version 18
__lua__

#include lib.lua
#include constants.lua
#include gfx.lua
#include gamestate.lua

-- # PICO CALLBACKS

function _init()
  game_state = create_game_state()
  advance_simulation()
end

function _draw()
  if(not game_state) then return end
  --Background
	rectfill(0,0,127,127,0)
  --Scene
  if(game_state.current_planet_scene == 'warpspace') then
    draw_warp_scene()
  else
    draw_planet_scene(game_state.current_planet_scene)
  end
  --Border
	rect(0,0,127,127,1)
end

function _update()
  --Update the scene
  update_scene(game_state.current_planet_scene)
  -- Navigating with Cursor
  local dir
  if active_interface() and not game_over then
    local current_splat = game_state[active_interface()].current_splat
    local tgt = game_state[active_interface()].splats[current_splat]

    --Pressed D-Pad: Navigate to directed splat
    if (btnp(0)) then dir = 'left' end
    if (btnp(1)) then dir = 'right' end
    if (btnp(2)) then dir = 'up' end
    if (btnp(3)) then dir = 'down' end
    if(tgt and tgt[dir]) then game_state[active_interface()].current_splat = tgt[dir] end
    --Pressed B: Perform the current splat if it has something to do
    if btnp(4) and current_splat then game_state[active_interface()].splats[current_splat].execute() end
    --Pressed A: Pop the view stack
    if (btnp(5)) then pop_interface() end
  end
end

__gfx__
00000000000006c00000090000000000000bb0000000666600076500000a00000000444000000050000000000000000000000000000000000008000000000000
000000000006c060000090000000000000b333000006666500566650033b3330000400a00000c5500000000000000000000000000000000000050c0000080000
0050050006c06060000900000000444000000330006666550015661003b33ba000500000000c5500000000000000000000000000000000000005050000050000
0005500000606060009000b0ff004444b00b333b066665550011118003b3b33005c5000000c55000000000000000000000000000000000000005050000050000
000550005555606009900bbbfff444480bb3333b777755560081188003bb3ba0005c560000456000000000000000000000000000000000005555555555555550
005005005aa55556009900b0004444880333b330077555600018881033b33b3006666690044660aa000000000000000000000000000000000333535333353300
000000005aa55a560009900066666666444b34340775560000111110833b3b306888889044000088000000000000000000000000000000000555555555555550
000000005555555600009900000666600444b4407777600000011100000a000006666690040088a8000000000000000000000000000000005533535353535330
00800000000666600006060000b50bb000bb00000000030000030333000000000000000000000000000000000000000000000000000000000555555555555555
0010800006677770060000060bb5dd54004400b03033053005333333000000000000000000000000000000000000000000000000000000000055535333335350
0010100060070677777606005d00b5150bd0bb400333351335053535000000000000000000000000000000000000000000000000000000000005555555551115
001110000006777060777660d00b050b04bd4b00035553305531133300000000000000000000000000000000000000000000000000000000000055511551ccc1
001d10000777766066607760405d5d55d04db4b0033333535513330300000000000000000000000000000000000000000000000000000000000055511551ccc1
001110007706677777767760b35b05b400bb40403311353330355303000000000000000000000000000000000000000000000000000000000000505115066666
001d100006677700667676005b3b10500044044d3551553333303033000000000000000000000000000000000000000000000000000000000000005555500500
00111000000670007000660004411000000004000003333000333030000000000000000000000000000000000000000000000000000000000000005555055500
001d1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000555000000
00111000000000000000667000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000555000000
001d1001000000760777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000555000000
001110010000076000660700009fff00000666000000000000000000000000000000000000000000000000000000000000000000000000000000000555000000
001d11110006760000067660095555f00fff65500000000000000000000000000000000000000000000000000000000000000000000000000000000155000000
10111dd1006070000777776099555ff9fffff5550000000000000000000000000000000000000000000000000000000000000000000000000000000105000000
101d111106700000000007000999ff900fff55550000000000000000000000000000000000000000000000000000000000000000000000000000000105000000
11111111070000000060000000090099000f55000000000000000000000000000000000000000000000000000000000000000000000000000000000105000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000118000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008100000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b00000000
__sfx__
000100000000000020000300a6400f64011650106500f6300f6302302015630036200c1200f1200c3300c3300e3500f370191701d1701b060166701b050100401603027030047300b73013760157501775018750
__music__
00 40424344

