pico-8 cartridge // http://www.pico-8.com
version 18
__lua__

#include lib.lua
#include constants.lua
#include gfx.lua
#include gamestate.lua

-- # PICO CALLBACKS

function _init()
  g = create_game_state()
  advance_simulation(20)
  music(0)
end

function _draw()
  if(not g) then return end
  --Background
	rectfill(0,0,127,127,0)
  --Scene
  if(g.current_planet_scene == 'warpspace') then
    draw_warp_scene()
  else
    draw_planet_scene(g.current_planet_scene)
  end
  --Border
	rect(0,0,127,127,1)
end

function _update()
  --Update the scene
  update_scene(g.current_planet_scene)
  -- Navigating with Cursor
  local dir
  if active_interface() and not game_over then
    local current_splat = g[active_interface()].current_splat
    local tgt = g[active_interface()].splats[current_splat]

    --Pressed D-Pad: Navigate to directed splat
    if (btnp(0)) then dir = 'left' end
    if (btnp(1)) then dir = 'right' end
    if (btnp(2)) then dir = 'up' end
    if (btnp(3)) then dir = 'down' end
    if(tgt and tgt[dir]) then g[active_interface()].current_splat = tgt[dir] end
    --Pressed B: Perform the current splat if it has something to do
    if btnp(4) and current_splat then g[active_interface()].splats[current_splat].execute() end
    --Pressed A: Pop the view stack
    if (btnp(5)) then pop_interface() end
  end
end

__gfx__
00000000060066000000090000000000000bb0000000666600076500000a00000000444000000050000006660000000000000000000000000008000000000000
00000000600600d0000090000000000000b3330000066665005bbb50033b3330000400a00000c5500777006000000000000000000000000000050c0000080000
005005000600d0d0000900000000444000000330006666550015551003b33ba000500000000c5500070700660000000000000000000000000005050000050000
0005500000d0d0d0009000b0ff004444b00b333b0666655500111a1003b3b33005c5000000c55000777770750000000000000000000000000005050000050000
000550001111d0d009900bbbfff444480bb3333b777755560011a11003bb3ba0005c560000456000778770750000000000000000000000005555555555555550
005005001dd1111d009900b0004444880333b3300775556000111a1033b33b3006666690044660aa788870750000000000000000000000000333535333353300
000000001dd11d1d0009900066666666444b3434077556000011a110833b3b306888889044000088778770700000000000000000000000000555555555555550
000000001111111d00009900000666600444b4407777600000011100000a000006666690040088a8777770700000000000000000000000005533535353535330
00800000000666600006060000b50bb000bb00000000030000030333000000000000000000000000000000000000000000000000000000000555555555555555
0010800006677770060000060bb5dd54004400b03033053005333333000000000000000000000000000000000000000000000000000000000055535333335350
0010100060070677777606005d00b5150bd0bb400333351335053535000000000000000000000000000000000000000000000000000000000005555555551115
001110000006777060777660d00b050b04bd4b00035553305531133300000000000000000000000000000000000000000000000000000000000055511551ccc1
001d10000777766066607760405d5d55d04db4b0033333535513330300000000000000000000000000000000000000000000000000000000000055511551ccc1
001110007706677777767760b35b05b400bb40403311353330355303000000000000000000000000000000000000000000000000000000000000505115066666
001d100006677700667676005b3b10500044044d3551553333303033000000000000000000000000000000000000000000000000000000000000005555500500
00111000000670007000660004411000000004000003333000333030000000000000000000000000000000000000000000000000000000000000005555055500
001d1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000555000000
00111000000000000000667000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000555000000
001d1001000000760777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000555000000
001110010000076000660700009fff00000666000000000000000000000000000000000000000000000000000000000000000000000000000000000555000000
001d11110006760000067660095555f00fff65500000000000000000000000000000000000000000000000000000000000000000000000000000000155000000
10111dd1006070000777776099555ff9fffff5550000000000000000000000000000000000000000000000000000000000000000000000000000000105000000
101d111106700000000007000999ff900fff55550000000000000000000000000000000000000000000000000000000000000000000000000000000105000000
11111111070000000060000000090099000f55000000000000000000000000000000000000000000000000000000000000000000000000000000000105000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000118000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008100000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b00000000
__sfx__
002000000e0501005011050110501105013050150501505013050130501105011050100501005011050100500e0500e0501005010050110501105011050100501105011050130501305013050150501805018050
001000001a0501a0501a0501a0501a0501a0501a0501a050180501805018050180501505015050150501505015050150501505015050150501505015050150501505015050150501505015050150501505015050
0010000015050150501a0501a0501a0501a0501505015050150501505015050150501a0501a050180501805015050150501505015050180501805018050180501705017050150501505013050130501305013050
00100000150501505015050150501605016050150501505013050130501305013050110501105011050110501005010050100501005010050100501105011050100501005010050100500e0500e0501005010050
001000001105011050110501105013050130501305013050150501505015050150501505015050160501605015050150501305013050150501505015050150501505015050150501505015050150501505015050
0010000013050130501105011050100501005010050100500e0500e0500e0500e0500c0500c0500c0500c0501005010050100501005010050100500c0500c0500e0500e0500e0500e0500e0500e0500e0500e050
001000000e0500e0500e0500e0501005010050100501005010050100500c0500c0500e0500e0500e0500e0500e0500e0500e0500e0500e0500e0500e0500e0500e0500e0500e0500e0500e0500e0500e0500e050
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0010002039630206301f640146401a65017650176601566018660116601a67015670146701b6701d6701a660156601a6501a6501566015670156701967015670146701c670156601665017640176402463017630
000400002d620356503c4703d4703e6703c6701f470356602d6502a6700c44020670196301667005420116700b6200e6500a65009640086400664006630056300563005630056100462003620026100161001600
001000002a6703b4702a670216702e4602265017650116500f65015440106300e6300b6200b620096100761007610056000460002600026000260002600026001805024450026000160018050244500260002600
__music__
00 00404344
00 01424344
00 02424344
00 03424344
00 04424344
00 05424344
02 06424344
04 07424344

