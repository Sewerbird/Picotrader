pico-8 cartridge // http://www.pico-8.com
version 18
__lua__

#include lib.lua
#include constants.lua
#include gfx.lua
#include gamestate.lua

-- # PICO CALLBACKS

function _init()
  g = create_game_state()
  advance_simulation(20)
end

function _draw()
  if(not g) then return end
  --Background
	rectfill(0,0,127,127,0)
  --Scene
  if(g.current_planet_scene == 'warpspace') then
    draw_warp_scene()
  else
    draw_planet_scene(g.current_planet_scene)
  end
  --Border
	rect(0,0,127,127,1)
end

function _update()
  --Update the scene
  update_scene(g.current_planet_scene)
  -- Navigating with Cursor
  local dir
  if active_interface() and not game_over then
    local current_splat = g[active_interface()].current_splat
    local tgt = g[active_interface()].splats[current_splat]

    --Pressed D-Pad: Navigate to directed splat
    if (btnp(0)) then dir = 'left' end
    if (btnp(1)) then dir = 'right' end
    if (btnp(2)) then dir = 'up' end
    if (btnp(3)) then dir = 'down' end
    if(tgt and tgt[dir]) then 
      sfx(39)
      g[active_interface()].current_splat = tgt[dir] 
    end
    --Pressed B: Perform the current splat if it has something to do
    if btnp(4) and current_splat then g[active_interface()].splats[current_splat].execute() end
    --Pressed A: Pop the view stack
    if (btnp(5)) then 
      sfx(38)
      pop_interface() 
    end
  end
end

__gfx__
00000000060066000000090000000000000bb0000000666600076500000a00000000444000000050000006660000000000000000000000000008000000000000
00000000600600d0000090000000000000b3330000066665005bbb50033b3330000400a00000c5500777006000000000000000000000000000050c0000080000
005005000600d0d0000900000000444000000330006666550015551003b33ba000500000000c5500070700660000000000000000000000000005050000050000
0005500000d0d0d0009000b0ff004444b00b333b0666655500111a1003b3b33005c5000000c55000777770750000000000000000000000000005050000050000
000550001111d0d009900bbbfff444480bb3333b777755560011a11003bb3ba0005c560000456000778770750000000000000000000000005555555555555550
005005001dd1111d009900b0004444880333b3300775556000111a1033b33b3006666690044660aa788870750000000000000000000000000333535333353300
000000001dd11d1d0009900066666666444b3434077556000011a110833b3b306888889044000088778770700000000000000000000000000555555555555550
000000001111111d00009900000666600444b4407777600000011100000a000006666690040088a8777770700000000000000000000000005533535353535330
00800000000666600006060000b50bb000bb00000000030000030333000000000000000000000000000000000000000000000000000000000555555555555555
0010800006677770060000060bb5dd54004400b03033053005333333000000000000000000000000000000000000000000000000000000000055535333335350
0010100060070677777606005d00b5150bd0bb400333351335053535000000000000000000000000000000000000000000000000000000000005555555551115
001110000006777060777660d00b050b04bd4b00035553305531133300000000000000000000000000000000000000000000000000000000000055511551ccc1
001d10000777766066607760405d5d55d04db4b0033333535513330300000000000000000000000000000000000000000000000000000000000055511551ccc1
001110007706677777767760b35b05b400bb40403311353330355303000000000000000000000000000000000000000000000000000000000000505115066666
001d100006677700667676005b3b10500044044d3551553333303033000000000000000000000000000000000000000000000000000000000000005555500500
00111000000670007000660004411000000004000003333000333030000000000000000000000000000000000000000000000000000000000000005555055500
001d1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000555000000
00111000000000000000667000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000555000000
001d1001000000760777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000555000000
001110010000076000660700009fff00000666000000000000000000000000000000000000000000000000000000000000000000000000000000000555000000
001d11110006760000067660095555f00fff65500000000000000000000000000000000000000000000000000000000000000000000000000000000155000000
10111dd1006070000777776099555ff9fffff5550000000000000000000000000000000000000000000000000000000000000000000000000000000105000000
101d111106700000000007000999ff900fff55550000000000000000000000000000000000000000000000000000000000000000000000000000000105000000
11111111070000000060000000090099000f55000000000000000000000000000000000000000000000000000000000000000000000000000000000105000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000118000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008100000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b00000000
__sfx__
002000000e0221003211042110421105213052150521504213042130321103211032100321003211052100520e0520e0521004210032110321104211042100421104211042130521305213052150521806218052
001000001a0621a0521a0521a0521a0421a0421a0321a052180521804218042180421504215052150521503215032150321503215022150221502215022150221501215012150121501215012150121501215012
0010000015022150321a0621a0621a0521a0621506215052150521505215052150321a0621a052180521805215052150421503215032180621805218052180421704217042150421504213042130521305213052
00100000150321503215032150321605216052150621506213052130521304213042110421104211042110321005210062100521005210052100521105211052100521005210052100520e0520e0521005210052
001000001105211052110521105213062130621306213062150721507215072150721506215062160621606215042150421305213052150621507215062150521505215052150521505215052150521505215052
0010000013052130421104211042100421004210042100520e0520e0420e0420e0320c0520c0420c0520c0521005210052100521005210052100520c0620c0620e0620e0620e0620e0620e0520e0620e0620e062
001000000e0520e0420e0420e0321005210052100521005210052100520c0620c0620e0420e0420e0520e0520e0520e0520e0520e0520e0420e0320e0320e0320e0320e0220e0220e0220e0220e0220e0220e012
011000000e0520e0520e0520e0520e0520e0520e0520e05200000000000000000000000000000000000000000e0520e0520e0520e0520e0520e0520e0520e0520000000000000000000000000000000000000000
011000000e0520e0520e0520e0520e0520e0520e0520e05209052090520905209052090520905209052090520a0520a0520a0520a0520a0520a0520a0520a0520905209052090520905209052090520c0520c052
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000201d6301c6301f640146401a65017650176601566018650116501a65015650146501b6501d6401a640156401a6401a6401564015640156501965015650146501c650156501665017640176402463017630
000400002d620356503c4703d4703e6703c6701f470356602d6502a6700c44020670196301667005420116700b6200e6500a65009640086400664006630056300563005630056100462003620026100161001600
000800002a6703b4702a660216602e4502265017630116300f6201541008610056100261001610006100061000000056000460002600026000260002600026001800000000026000160018000244000260002600
000800001b0501e050002001120011200112000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000800001c05017050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000b45000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000001212000102001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000553000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000200002d4400f05025450150501f460190701b4701f06015460220601165025050126502804009440280401263024030136301e030156301803018620120301a6300e0401d6501e6501f650216502165023650
00040000000000000000000134500000000000000000e05000000000000000008050000000000000000000000000000000100500000000000000000000000000000001e0501f0500000021050000000000000000
000800000b000000000a0000a000000000a0100061000010000100061000620006200062001620016200630006300063000630006300053000430004300033000330000000000000000000000000000000000000
000400001722000000000000000009220000000000000000000000000000000000000000000000000000000000000002100000000000000000000000000000000000000000000000000000000000000000000000
010400001d0551d0551d0551d055000001905500000000001d0551d0551d0551d055000000000019055000001d0551d0551d0551d055000001905500000000002b0550000000000000002b055000000000000000
000400000061000620016100161001610016100061000620006100161003610036200462004630046200362002610026100161001610026100262002620026200162000620006100061001610036100461000010
__music__
00 08404344
00 08424344
00 08424344
00 08424344
00 00424344
00 01424344
00 02424344
00 03424344
00 04424344
00 05424344
04 06424344
00 40424344

